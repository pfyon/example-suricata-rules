#Pingbed begin
alert tcp any any -> any any (\
	msg:"Pingbed simple rule";\
	content:"GET /default.htm HTTP/1.1|0d 0a|"; offset:0; depth:27;\
	content:"User-Agent: Windows+NT+5.1|0d 0a|"; distance:0; within: 100;\
	reference:url,https://contagiodump.blogspot.com/2013/04/collection-of-pcap-files-from-malware.html;\
	metadata:file Pingbed_74fc916a0187f3d491ef9fb0b540f228.pcap;\
	sid:1;\
	rev:1;\
)

alert http any any -> any any (\
	msg:"Pingbed suricata rule";\
	http.user_agent; content:"Windows+NT+5.1";\
	http.uri; content:"default.htm";\
	reference:url,https://contagiodump.blogspot.com/2013/04/collection-of-pcap-files-from-malware.html;\
	metadata:file Pingbed_74fc916a0187f3d491ef9fb0b540f228.pcap;\
	sid:2;\
	rev:1;\
)
#Pingbend end

#Taidoor begin
alert tcp any any -> any any (\
	msg:"Taidoor simple rule";\
	content:"111D309GE67E"; offset:24; depth:12;\
	pcre:"/^GET \/[a-z]{5}\.php\?id=[0-9]{6}111D309GE67E HTTP\/1.1/";\
	reference:url,https://contagiodump.blogspot.com/2013/04/collection-of-pcap-files-from-malware.html;\
	metadata:file BIN_Taidoor_40D79D1120638688AC7D9497CC819462_2012-10.pcap;\
	sid:3;\
	rev:1;\
)

alert http any any -> any any (\
	msg:"Taidoor suricata rule";\
	http.uri; content:"111D309GE67E"; pcre:"/^\/[a-z]{5}\.php\?id=[0-9]{6}111D309GE67E$/";\
	reference:url,https://contagiodump.blogspot.com/2013/04/collection-of-pcap-files-from-malware.html;\
	metadata:file BIN_Taidoor_40D79D1120638688AC7D9497CC819462_2012-10.pcap;\
	sid:4;\
	rev:1;\
)
#Taidoor end

#Gh0st-gif begin
alert tcp any any -> any any (\
	msg:"Gh0st-gif simple rule";\
	content:"GET /h.gif?pid ="; offset:0; depth:16;\
	content:"&v="; distance:3; within:3;\
	pcre:"/^GET \/h\.gif\?pid =[0-9]{3}&v=[0-9]{12} HTTP\/1\.1/";\
	reference:url,https://contagiodump.blogspot.com/2013/04/collection-of-pcap-files-from-malware.html;\
	metadata:file BIN_Gh0st-gif_f4d4076dff760eb92e4ae559c2dc4525.pcap;\
	sid:5;\
	rev:1;\
)

#Currently, http.uri has a bug with parsing uris with spaces on them. See https://redmine.openinfosecfoundation.org/issues/2881
alert http any any -> any any (\
	msg:"Gh0st-gif suricata rule";\
	http.request_line; content:"/h.gif?pid ="; content:"&v="; distance:3; within:3; pcre:"/^GET \/h\.gif\?pid =[0-9]{3}&v=[0-9]{12} HTTP\/1\.1$/";\
	reference:url,https://contagiodump.blogspot.com/2013/04/collection-of-pcap-files-from-malware.html;\
	metadata:file BIN_Gh0st-gif_f4d4076dff760eb92e4ae559c2dc4525.pcap;\
	sid:6;\
	rev:1;\
)
#Gh0st-gif end

#Hupigon begin #TODO: Finish hupigon after dealing with https://forum.suricata.io/t/different-behaviour-between-byte-test-and-content-when-using-flowbits/1361
alert tcp any any -> any any (\
	msg:"Hupigon suricata rule - connection setup byte_test (works)";\
	dsize:4;\
	byte_test:4,=,0,0;\
	flowbits:set,hupigon.start;\
	reference:url,https://contagiodump.blogspot.com/2013/04/collection-of-pcap-files-from-malware.html;\
	metadata:file BIN_Hupigon_8F90057AB244BD8B612CD09F566EAC0C.pcap;\
	sid:7;\
	rev:1;\
)

alert tcp any any -> any any (\
	msg:"Hupigon suricata rule - connection setup content (works)";\
	dsize:4;\
	content:"|00 00 00 00|"; offset:0; depth:4;\
	flowbits:set,hupigon.start;\
	reference:url,https://contagiodump.blogspot.com/2013/04/collection-of-pcap-files-from-malware.html;\
	metadata:file BIN_Hupigon_8F90057AB244BD8B612CD09F566EAC0C.pcap;\
	sid:8;\
	rev:1;\
)

#Note that byte_extract can only handle 8 bytes in non string mode. There are actually 12 static bytes here
alert tcp any any -> any any (\
	msg:"Hupigon suricata rule - beacon byte_test offset 4 (works)";\
	byte_test:8,=,0xc1d6c1d6c9cfcfdf,4;\
	flowbits:isset,hupigon.start;\
	reference:url,https://contagiodump.blogspot.com/2013/04/collection-of-pcap-files-from-malware.html;\
	metadata:file BIN_Hupigon_8F90057AB244BD8B612CD09F566EAC0C.pcap;\
	sid:9;\
	rev:1;\
)

alert tcp any any -> any any (\
	msg:"Hupigon suricata rule - beacon byte_test offset 0 (does not work)";\
	byte_test:8,=,0xc1d6c1d6c9cfcfdf,0;\
	flowbits:isset,hupigon.start;\
	reference:url,https://contagiodump.blogspot.com/2013/04/collection-of-pcap-files-from-malware.html;\
	metadata:file BIN_Hupigon_8F90057AB244BD8B612CD09F566EAC0C.pcap;\
	sid:10;\
	rev:1;\
)

alert tcp any any -> any any (\
	msg:"Hupigon suricata rule - beacon content offset 0 (works)";\
	flowbits:isset,hupigon.start;\
	byte_test:8,=,0xc1d6c1d6c9cfcfdf,0;\
	reference:url,https://contagiodump.blogspot.com/2013/04/collection-of-pcap-files-from-malware.html;\
	metadata:file BIN_Hupigon_8F90057AB244BD8B612CD09F566EAC0C.pcap;\
	sid:11;\
	rev:1;\
)

#Hupigon end
#	flowbits:isnotset,hupigon.start;\
#	flowbits:noalert;\
#	byte_test:8,=,0xc1d6c1d6c9cfcfdf,0;\
#	byte_test:8,=,0xc1d6c1d6c9cfcfdf,212;\
#	content:"|c1 d6 c1 d6 c9 cf cf df|"; offset:212; depth:8;\
	#	byte_extract:8,0,hupigon.static_bytes;\
	#	byte_test:8,=,hupigon.static_bytes,212;\
	#


#Enfal_lurid begin
alert tls any any -> any any (\
	msg:"Enfal_lurid suricata rule";\
	ja3.hash; content:"de350869b8c85de67a350c8d186f11e6";\
	reference:url,https://contagiodump.blogspot.com/2013/04/collection-of-pcap-files-from-malware.html;\
	metadata:file BIN_Enfal_Lurid_0fb1b0833f723682346041d72ed112f9_2013-01.pcap;\
	sid:12;\
	rev:1;\
)
#Enfal_lurid end

#Tapaoux begin
alert tcp any any -> any any (\
	msg:"Tapaoux simple rule GET";\
	content:"GET /ol/yahoo/banner"; offset:0; depth:20;\
	content:".php?jpg=../"; distance:1; within:12;\
	reference:url,https://contagiodump.blogspot.com/2013/04/collection-of-pcap-files-from-malware.html;\
	metadata:file BIN_Tapaoux_60AF79FB0BD2C9F33375035609C931CB_winver_2011-08-23.pcap;\
	sid:13;\
	rev:1;\
)

alert tcp any any -> any any (\
	msg:"Tapaoux simple rule POST";\
	content:"POST /ol/yahoo/banner"; offset:0; depth:21;\
	content:".php"; distance:1; within:4;\
	content:"Content-Disposition: form-data|3b| name=|22|dirname|22 0d 0a 0d 0a|../"; distance:0;\
	reference:url,https://contagiodump.blogspot.com/2013/04/collection-of-pcap-files-from-malware.html;\
	metadata:file BIN_Tapaoux_60AF79FB0BD2C9F33375035609C931CB_winver_2011-08-23.pcap;\
	sid:14;\
	rev:1;\
)

alert http any any -> any any (\
	msg:"Tapaoux suricata rule GET";\
	http.method; content:"GET";\
	http.uri; content:"/ol/yahoo/banner"; content:".php?jpg=../"; distance:1; within:12;\
	reference:url,https://contagiodump.blogspot.com/2013/04/collection-of-pcap-files-from-malware.html;\
	metadata:file BIN_Tapaoux_60AF79FB0BD2C9F33375035609C931CB_winver_2011-08-23.pcap;\
	sid:15;\
	rev:1;\
)

alert http any any -> any any (\
	msg:"Tapaoux suricata rule POST";\
	http.method; content:"POST";\
	http.uri; content:"/ol/yahoo/banner"; content:".php"; distance:1; within:4;\
	http.request_body; content:"Content-Disposition: form-data|3b| name=|22|dirname|22 0d 0a 0d 0a|../";\
	reference:url,https://contagiodump.blogspot.com/2013/04/collection-of-pcap-files-from-malware.html;\
	metadata:file BIN_Tapaoux_60AF79FB0BD2C9F33375035609C931CB_winver_2011-08-23.pcap;\
	sid:16;\
	rev:1;\
)
#Tapaoux end

#IXESHE begin
alert tcp any any -> any any (\
	msg:"IXESHE simple rule";\
	content:"GET /AWS96.jsp"; offset:0; depth:14;\
	content:"x_bigfix_client_string"; distance:2;\
	reference:url,https://contagiodump.blogspot.com/2013/04/collection-of-pcap-files-from-malware.html;\
	metadata:file BIN_IXESHE_0F88D9B0D237B5FCDC0F985A548254F2-2013-05.pcap;\
	sid:17;\
	rev:1;\
)

alert http any any -> any any (\
	msg:"IXESHE suricata rule";\
	http.uri; content:"/AWS96.jsp";\
	http.header_names; content:"|0d 0a|x_bigfix_client_string|0d 0a|";\
	reference:url,https://contagiodump.blogspot.com/2013/04/collection-of-pcap-files-from-malware.html;\
	metadata:file BIN_IXESHE_0F88D9B0D237B5FCDC0F985A548254F2-2013-05.pcap;\
	sid:18;\
	rev:1;\
)
#IXESHE end

#Darkcomet begin
#The id= parameter seems to be a base64 encoded email address. Assuming the absolute smallest email address looks like a@b.c results in a minimum base64 length of 8 chars
#base64_decode is given a large number of bytes, since decoding will end at the end of the buffer anyway
#I tried combing pcrexform with base64_decode, but base64_decode doesn't seem to want to use the output buffer from pcrexform
alert http any any -> any any (\
	msg:"Darkcomet suricata rule";\
	http.method; content:"GET";\
	http.uri; content:"id="; base64_decode: bytes 500, offset 0, relative;\
	base64_data; content:"@";\
	reference:url,https://contagiodump.blogspot.com/2013/04/collection-of-pcap-files-from-malware.html;\
	metadata:file Darkcomet_DC98ABBA995771480AECF4769A88756E.pcap;\
	sid:19;\
	rev:1;\
)
#Darkcomet end

#TrojanCookies begin
alert tcp any any -> any any (\
	msg:"TrojanCookies simple rule";\
	content:"GET /"; offset:0; depth:5;\
	content:"Set-Cookie: "; distance:0;\
	content:"Mozilla/4.0 (compatible|3b| MSIE 7.0|3b| Windows NT 5.1)"; distance:100;\
	pcre:"/Set-Cookie: [a-zA-Z0-9+/]{100,}/";\
	reference:url,https://contagiodump.blogspot.com/2013/04/collection-of-pcap-files-from-malware.html;\
	metadata:file BIN_TrojanCookies_840BD11343D140916F45223BA05ABACB_2012_01.pcap;\
	sid:20;\
	rev:1;\
)

alert http any any -> any any (\
	msg:"TrojanCookies suricata rule";\
	flow:established,to_server;\
	http.header_names; content:"|0d 0a|Set-Cookie|0d 0a|";\
	http.user_agent; content:"Mozilla/4.0 (compatible|3b| MSIE 7.0|3b| Windows NT 5.1)";\
	http.header; pcre:"/Set-Cookie: [a-zA-Z0-9+/]{100,}/";\
	reference:url,https://contagiodump.blogspot.com/2013/04/collection-of-pcap-files-from-malware.html;\
	metadata:file BIN_TrojanCookies_840BD11343D140916F45223BA05ABACB_2012_01.pcap;\
	sid:21;\
	rev:1;\
)
#TrojanCookies end
