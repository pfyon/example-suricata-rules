#Pingbed begin
alert tcp any any -> any any (\
	msg:"Pingbed simple rule";\
	content:"GET /default.htm HTTP/1.1|0d 0a|"; offset:0; depth:27;\
	content:"User-Agent: Windows+NT+5.1|0d 0a|"; distance:0; within: 100;\
	reference:url,https://contagiodump.blogspot.com/2013/04/collection-of-pcap-files-from-malware.html;\
	metadata:file Pingbed_74fc916a0187f3d491ef9fb0b540f228.pcap;\
	sid:1;\
	rev:1;\
)

alert http any any -> any any (\
	msg:"Pingbed suricata rule";\
	http.user_agent; content:"Windows+NT+5.1";\
	http.uri; content:"default.htm";\
	reference:url,https://contagiodump.blogspot.com/2013/04/collection-of-pcap-files-from-malware.html;\
	metadata:file Pingbed_74fc916a0187f3d491ef9fb0b540f228.pcap;\
	sid:2;\
	rev:1;\
)
#Pingbend end

#Taidoor begin
alert tcp any any -> any any (\
	msg:"Taidoor simple rule";\
	content:"111D309GE67E"; offset:24; depth:12;\
	pcre:"/^GET \/[a-z]{5}\.php\?id=[0-9]{6}111D309GE67E HTTP\/1.1/";\
	reference:url,https://contagiodump.blogspot.com/2013/04/collection-of-pcap-files-from-malware.html;\
	metadata:file BIN_Taidoor_40D79D1120638688AC7D9497CC819462_2012-10.pcap;\
	sid:3;\
	rev:1;\
)

alert http any any -> any any (\
	msg:"Taidoor suricata rule";\
	http.uri; content:"111D309GE67E"; pcre:"/^\/[a-z]{5}\.php\?id=[0-9]{6}111D309GE67E$/";\
	reference:url,https://contagiodump.blogspot.com/2013/04/collection-of-pcap-files-from-malware.html;\
	metadata:file BIN_Taidoor_40D79D1120638688AC7D9497CC819462_2012-10.pcap;\
	sid:4;\
	rev:1;\
)
#Taidoor end

#Gh0st-gif begin
alert tcp any any -> any any (\
	msg:"Gh0st-gif simple rule";\
	content:"GET /h.gif?pid ="; offset:0; depth:16;\
	content:"&v="; distance:3; within:3;\
	pcre:"/^GET \/h\.gif\?pid =[0-9]{3}&v=[0-9]{12} HTTP\/1\.1/";\
	reference:url,https://contagiodump.blogspot.com/2013/04/collection-of-pcap-files-from-malware.html;\
	metadata:file BIN_Gh0st-gif_f4d4076dff760eb92e4ae559c2dc4525.pcap;\
	sid:5;\
	rev:1;\
)

#Currently, http.uri has a bug with parsing uris with spaces on them. See https://redmine.openinfosecfoundation.org/issues/2881
alert http any any -> any any (\
	msg:"Gh0st-gif suricata rule";\
	http.request_line; content:"/h.gif?pid ="; content:"&v="; distance:3; within:3; pcre:"/^GET \/h\.gif\?pid =[0-9]{3}&v=[0-9]{12} HTTP\/1\.1$/";\
	reference:url,https://contagiodump.blogspot.com/2013/04/collection-of-pcap-files-from-malware.html;\
	metadata:file BIN_Gh0st-gif_f4d4076dff760eb92e4ae559c2dc4525.pcap;\
	sid:6;\
	rev:1;\
)
#Gh0st-gif end

#Hupigon begin #TODO: Finish hupigon after dealing with https://forum.suricata.io/t/different-behaviour-between-byte-test-and-content-when-using-flowbits/1361
alert tcp any any -> any any (\
	msg:"Hupigon suricata rule - connection setup byte_test (works)";\
	dsize:4;\
	byte_test:4,=,0,0;\
	flowbits:set,hupigon.start;\
	reference:url,https://contagiodump.blogspot.com/2013/04/collection-of-pcap-files-from-malware.html;\
	metadata:file BIN_Hupigon_8F90057AB244BD8B612CD09F566EAC0C.pcap;\
	sid:7;\
	rev:1;\
)

alert tcp any any -> any any (\
	msg:"Hupigon suricata rule - connection setup content (works)";\
	dsize:4;\
	content:"|00 00 00 00|"; offset:0; depth:4;\
	flowbits:set,hupigon.start;\
	reference:url,https://contagiodump.blogspot.com/2013/04/collection-of-pcap-files-from-malware.html;\
	metadata:file BIN_Hupigon_8F90057AB244BD8B612CD09F566EAC0C.pcap;\
	sid:8;\
	rev:1;\
)

#Note that byte_extract can only handle 8 bytes in non string mode. There are actually 12 static bytes here
alert tcp any any -> any any (\
	msg:"Hupigon suricata rule - beacon byte_test offset 4 (works)";\
	byte_test:8,=,0xc1d6c1d6c9cfcfdf,4;\
	flowbits:isset,hupigon.start;\
	reference:url,https://contagiodump.blogspot.com/2013/04/collection-of-pcap-files-from-malware.html;\
	metadata:file BIN_Hupigon_8F90057AB244BD8B612CD09F566EAC0C.pcap;\
	sid:9;\
	rev:1;\
)

alert tcp any any -> any any (\
	msg:"Hupigon suricata rule - beacon byte_test offset 0 (does not work)";\
	byte_test:8,=,0xc1d6c1d6c9cfcfdf,0;\
	flowbits:isset,hupigon.start;\
	reference:url,https://contagiodump.blogspot.com/2013/04/collection-of-pcap-files-from-malware.html;\
	metadata:file BIN_Hupigon_8F90057AB244BD8B612CD09F566EAC0C.pcap;\
	sid:10;\
	rev:1;\
)

alert tcp any any -> any any (\
	msg:"Hupigon suricata rule - beacon content offset 0 (works)";\
	flowbits:isset,hupigon.start;\
	byte_test:8,=,0xc1d6c1d6c9cfcfdf,0;\
	reference:url,https://contagiodump.blogspot.com/2013/04/collection-of-pcap-files-from-malware.html;\
	metadata:file BIN_Hupigon_8F90057AB244BD8B612CD09F566EAC0C.pcap;\
	sid:11;\
	rev:1;\
)

#Hupigon end
#	flowbits:isnotset,hupigon.start;\
#	flowbits:noalert;\
#	byte_test:8,=,0xc1d6c1d6c9cfcfdf,0;\
#	byte_test:8,=,0xc1d6c1d6c9cfcfdf,212;\
#	content:"|c1 d6 c1 d6 c9 cf cf df|"; offset:212; depth:8;\
	#	byte_extract:8,0,hupigon.static_bytes;\
	#	byte_test:8,=,hupigon.static_bytes,212;\
	#


#Enfal_lurid begin
#NOTE: This ja3 is also shared by the TrojanPage pcap. It might reflect the sandbox and not the malware itself
alert tls any any -> any any (\
	msg:"Enfal_lurid suricata rule";\
	ja3.hash; content:"de350869b8c85de67a350c8d186f11e6";\
	reference:url,https://contagiodump.blogspot.com/2013/04/collection-of-pcap-files-from-malware.html;\
	metadata:file BIN_Enfal_Lurid_0fb1b0833f723682346041d72ed112f9_2013-01.pcap;\
	sid:12;\
	rev:1;\
)
#Enfal_lurid end

#Tapaoux begin
alert tcp any any -> any any (\
	msg:"Tapaoux simple rule GET";\
	content:"GET /ol/yahoo/banner"; offset:0; depth:20;\
	content:".php?jpg=../"; distance:1; within:12;\
	reference:url,https://contagiodump.blogspot.com/2013/04/collection-of-pcap-files-from-malware.html;\
	metadata:file BIN_Tapaoux_60AF79FB0BD2C9F33375035609C931CB_winver_2011-08-23.pcap;\
	sid:13;\
	rev:1;\
)

alert tcp any any -> any any (\
	msg:"Tapaoux simple rule POST";\
	content:"POST /ol/yahoo/banner"; offset:0; depth:21;\
	content:".php"; distance:1; within:4;\
	content:"Content-Disposition: form-data|3b| name=|22|dirname|22 0d 0a 0d 0a|../"; distance:0;\
	reference:url,https://contagiodump.blogspot.com/2013/04/collection-of-pcap-files-from-malware.html;\
	metadata:file BIN_Tapaoux_60AF79FB0BD2C9F33375035609C931CB_winver_2011-08-23.pcap;\
	sid:14;\
	rev:1;\
)

alert http any any -> any any (\
	msg:"Tapaoux suricata rule GET";\
	http.method; content:"GET";\
	http.uri; content:"/ol/yahoo/banner"; content:".php?jpg=../"; distance:1; within:12;\
	reference:url,https://contagiodump.blogspot.com/2013/04/collection-of-pcap-files-from-malware.html;\
	metadata:file BIN_Tapaoux_60AF79FB0BD2C9F33375035609C931CB_winver_2011-08-23.pcap;\
	sid:15;\
	rev:1;\
)

alert http any any -> any any (\
	msg:"Tapaoux suricata rule POST";\
	http.method; content:"POST";\
	http.uri; content:"/ol/yahoo/banner"; content:".php"; distance:1; within:4;\
	http.request_body; content:"Content-Disposition: form-data|3b| name=|22|dirname|22 0d 0a 0d 0a|../";\
	reference:url,https://contagiodump.blogspot.com/2013/04/collection-of-pcap-files-from-malware.html;\
	metadata:file BIN_Tapaoux_60AF79FB0BD2C9F33375035609C931CB_winver_2011-08-23.pcap;\
	sid:16;\
	rev:1;\
)
#Tapaoux end

#IXESHE begin
alert tcp any any -> any any (\
	msg:"IXESHE simple rule";\
	content:"GET /AWS96.jsp"; offset:0; depth:14;\
	content:"x_bigfix_client_string"; distance:2;\
	reference:url,https://contagiodump.blogspot.com/2013/04/collection-of-pcap-files-from-malware.html;\
	metadata:file BIN_IXESHE_0F88D9B0D237B5FCDC0F985A548254F2-2013-05.pcap;\
	sid:17;\
	rev:1;\
)

alert http any any -> any any (\
	msg:"IXESHE suricata rule";\
	http.uri; content:"/AWS96.jsp";\
	http.header_names; content:"|0d 0a|x_bigfix_client_string|0d 0a|";\
	reference:url,https://contagiodump.blogspot.com/2013/04/collection-of-pcap-files-from-malware.html;\
	metadata:file BIN_IXESHE_0F88D9B0D237B5FCDC0F985A548254F2-2013-05.pcap;\
	sid:18;\
	rev:1;\
)
#IXESHE end

#Darkcomet begin
#The id= parameter seems to be a base64 encoded email address. Assuming the absolute smallest email address looks like a@b.c results in a minimum base64 length of 8 chars
#base64_decode is given a large number of bytes, since decoding will end at the end of the buffer anyway
#I tried combing pcrexform with base64_decode, but base64_decode doesn't seem to want to use the output buffer from pcrexform
alert http any any -> any any (\
	msg:"Darkcomet suricata rule";\
	http.method; content:"GET";\
	http.uri; content:"id="; base64_decode: bytes 500, offset 0, relative;\
	base64_data; content:"@";\
	reference:url,https://contagiodump.blogspot.com/2013/04/collection-of-pcap-files-from-malware.html;\
	metadata:file Darkcomet_DC98ABBA995771480AECF4769A88756E.pcap;\
	sid:19;\
	rev:1;\
)
#Darkcomet end

#TrojanCookies begin
alert tcp any any -> any any (\
	msg:"TrojanCookies simple rule";\
	content:"GET /"; offset:0; depth:5;\
	content:"Set-Cookie: "; distance:0;\
	content:"Mozilla/4.0 (compatible|3b| MSIE 7.0|3b| Windows NT 5.1)"; distance:100;\
	pcre:"/Set-Cookie: [a-zA-Z0-9+/]{100,}/";\
	reference:url,https://contagiodump.blogspot.com/2013/04/collection-of-pcap-files-from-malware.html;\
	metadata:file BIN_TrojanCookies_840BD11343D140916F45223BA05ABACB_2012_01.pcap;\
	sid:20;\
	rev:1;\
)

alert http any any -> any any (\
	msg:"TrojanCookies suricata rule";\
	flow:established,to_server;\
	http.header_names; content:"|0d 0a|Set-Cookie|0d 0a|";\
	http.user_agent; content:"Mozilla/4.0 (compatible|3b| MSIE 7.0|3b| Windows NT 5.1)";\
	http.header; pcre:"/Set-Cookie: [a-zA-Z0-9+/]{100,}/";\
	reference:url,https://contagiodump.blogspot.com/2013/04/collection-of-pcap-files-from-malware.html;\
	metadata:file BIN_TrojanCookies_840BD11343D140916F45223BA05ABACB_2012_01.pcap;\
	sid:21;\
	rev:1;\
)
#TrojanCookies end

#Xinmic begin
alert tcp any any -> any any (\
	msg:"Xinmic simple rule - handshake";\
	content:"|14 00 00 00 00 00 00 00 00 00 06 3e|"; offset:0; depth:12;\
	dsize:12;\
	reference:url,https://contagiodump.blogspot.com/2013/04/collection-of-pcap-files-from-malware.html;\
	metadata:file Xinmic_8761F29AF1AE2D6FACD0AE5F487484A5.pcap;\
	sid:22;\
	rev:1;\
	)

alert tcp any any -> any any (\
	msg:"Xinmic simple rule - beacon";\
	content:"|13 10 05 00 02 00 00 00|"; offset:0; depth:8;\
	dsize:8;\
	reference:url,https://contagiodump.blogspot.com/2013/04/collection-of-pcap-files-from-malware.html;\
	metadata:file Xinmic_8761F29AF1AE2D6FACD0AE5F487484A5.pcap;\
	sid:23;\
	rev:1;\
	)

alert tcp any any -> any any (\
	msg:"Xinmic suricata rule - handshake";\
	content:"|14 00 00 00 00 00 00 00 00 00 06 3e|"; offset:0; depth:12;\
	dsize:12;\
	flowbits:set,xinmic.handshake;\
	flowbits:noalert;\
	reference:url,https://contagiodump.blogspot.com/2013/04/collection-of-pcap-files-from-malware.html;\
	metadata:file Xinmic_8761F29AF1AE2D6FACD0AE5F487484A5.pcap;\
	sid:24;\
	rev:1;\
	)

alert tcp any any -> any any (\
	msg:"Xinmic suricata rule - beacon";\
	content:"|13 10 05 00 02 00 00 00|"; offset:0; depth:8;\
	dsize:8;\
	flowbits:isset,xinmic.handshake;\
	reference:url,https://contagiodump.blogspot.com/2013/04/collection-of-pcap-files-from-malware.html;\
	metadata:file Xinmic_8761F29AF1AE2D6FACD0AE5F487484A5.pcap;\
	sid:25;\
	rev:1;\
	)
#Xinmic end

#NJRat begin
alert tcp any any -> any any (\
	msg:"NJRat simple rule - beacon";\
	dsize:6;\
	content:"|02 00 00 00 a2 00|"; offset:0; depth:6;\
	reference:url,https://contagiodump.blogspot.com/2013/04/collection-of-pcap-files-from-malware.html;\
	metadata:file BIN_NJRat-BackdoorLV_6fd868e68037040c94215566852230ab_CNtiananmensquare.pcap;\
	sid:26;\
	rev:1;\
	)

alert tcp-pkt any any -> any any (\
	msg:"NJRat suricata rule - host info";\
	content:"20"; offset:5; depth:2;\
	byte_test:4, >=, 2010, 5, string, dec;\
	byte_test:4, <=, 2030, 5, string, dec;\
	byte_test:2, >=, 1, 9, string, dec;\
	byte_test:2, <=, 12, 9, string, dec;\
	byte_test:2, >=, 1, 11, string, dec;\
	byte_test:2, <=, 31, 11, string, dec;\
	pcre:"/^.{5}20[1-3][0-9][01][0-9][0-3][0-9]/";\
	reference:url,https://contagiodump.blogspot.com/2013/04/collection-of-pcap-files-from-malware.html;\
	metadata:file BIN_NJRat-BackdoorLV_6fd868e68037040c94215566852230ab_CNtiananmensquare.pcap;\
	sid:27;\
	rev:1;\
	)
#NJRat end

#Taleret.E begin
alert tcp any any -> any any (\
	msg:"Taleret.E simple rule - random url";\
	content:"GET /"; offset:0; depth:5;\
	content:"Cookie: B="; distance:50;\
	content:"&b="; distance:10; within:8;\
	content:"&s="; distance:1; within:5;\
	content:"|0d 0a 0d 0a|"; distance:0; within:7;\
	reference:url,https://contagiodump.blogspot.com/2013/04/collection-of-pcap-files-from-malware.html;\
	metadata:file BIN_Taleret.E_5328cfcb46ef18ecf7ba0d21a7adc02c.pcap;\ 
	sid:28;\
	rev:1;\
	)

alert http any any -> any any (\
	msg:"Taleret.E suricata rule - random url";\
	http.method; content:"GET";\
	http.cookie; content:"B="; offset:0; depth:2; content:"&b="; distance:10; within:8; content:"&s="; distance:1; within:5;\
	http.header_names; content:"|0d 0a|Cookie|0d 0a 0d 0a|";\
	reference:url,https://contagiodump.blogspot.com/2013/04/collection-of-pcap-files-from-malware.html;\
	metadata:file BIN_Taleret.E_5328cfcb46ef18ecf7ba0d21a7adc02c.pcap;\ 
	sid:29;\
	rev:1;\
	)

alert tcp any any -> any 443 (\
	msg:"Taleret.E simple rule - http to port 443";\
	content:"GET / HTTP/1.1"; offset:0; depth:14;\
	content:"Cookie: MCI="; distance:50;\
	content:"|3b| MUID="; distance:26; within:7;\
	content:"|0d 0a 0d 0a|"; distance:28; within:4;\
	reference:url,https://contagiodump.blogspot.com/2013/04/collection-of-pcap-files-from-malware.html;\
	metadata:file BIN_Taleret.E_5328cfcb46ef18ecf7ba0d21a7adc02c.pcap;\ 
	sid:30;\
	rev:1;\
	)

alert http any any -> any 443 (\
	msg:"Taleret.E suricata rule - http to port 443";\
	http.method; content:"GET";\
	http.cookie; content:"MCI="; offset:0; depth:4; content:"|3b| MUID="; distance:26; within:7;\
	http.header_names; content:"|0d 0a|Cookie|0d 0a 0d 0a|";\
	reference:url,https://contagiodump.blogspot.com/2013/04/collection-of-pcap-files-from-malware.html;\
	metadata:file BIN_Taleret.E_5328cfcb46ef18ecf7ba0d21a7adc02c.pcap;\ 
	sid:31;\
	rev:1;\
	)
#Taleret.E end

#LURK begin
alert tcp any any -> any any (\
	msg:"LURK simple rule";\
	content:"LURK"; offset:0; depth:4;\
	reference:url,https://contagiodump.blogspot.com/2013/04/collection-of-pcap-files-from-malware.html;\
	metadata:file BIN_LURK_AF4E8D4BE4481D0420CCF1C00792F484_20120-10.pcap;\ 
	sid:32;\
	rev:1;\
	)

alert tcp any any -> any any (\
	msg:"LURK suricata rule - beacon";\
	content:"LURK"; offset:0; depth:4;\
	flow:established,to_server;\
	reference:url,https://contagiodump.blogspot.com/2013/04/collection-of-pcap-files-from-malware.html;\
	metadata:file BIN_LURK_AF4E8D4BE4481D0420CCF1C00792F484_20120-10.pcap;\ 
	sid:33;\
	rev:1;\
	)

alert tcp any any -> any any (\
	msg:"LURK suricata rule - response";\
	content:"LURK"; offset:0; depth:4;\
	flow:established,to_client;\
	reference:url,https://contagiodump.blogspot.com/2013/04/collection-of-pcap-files-from-malware.html;\
	metadata:file BIN_LURK_AF4E8D4BE4481D0420CCF1C00792F484_20120-10.pcap;\ 
	sid:34;\
	rev:1;\
	)
#LURK end

#DNSWatch begin
alert tcp any any -> any any (\
	msg:"DNSWatch simple rule";\
	content:"POST http://"; offset:0; depth:12;\
	content:"User-Agent: Mozilla/4.8.20 (compatible|3b| MSIE 5.0.2|3b| Win32)|0d 0a|"; distance:0;\
	content:"----------2B9250BB47EE537B|0d 0a|"; distance:0;\
	content:"new_host_"; distance:0;\
	reference:url,https://contagiodump.blogspot.com/2013/04/collection-of-pcap-files-from-malware.html;\
	metadata:file BIN_DNSWatch_protux_4F8A44EF66384CCFAB737C8D7ADB4BB8_2012-11.pcap;\ 
	sid:35;\
	rev:1;\
	)
#No suricata rule because the protocol is such garbage that it suricata doesn't recognize it as http at all
#DNSWatch end
